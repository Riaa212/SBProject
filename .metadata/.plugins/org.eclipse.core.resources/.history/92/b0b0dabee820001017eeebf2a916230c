package com.example.admin.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestPart;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.example.admin.domain.AdminEntity;
import com.example.admin.domain.LoginRequest;
import com.example.admin.domain.LoginResponse;
import com.example.admin.proxy.AdminProxy;
import com.example.admin.service.impl.AdminServiceImpl;
import com.example.admin.service.impl.RecaptchaService;

@RestController
@RequestMapping("/admin")
@CrossOrigin(origins = "http://localhost:4200")
public class AdminController {

	@Autowired
	private AdminServiceImpl service;
	
	 @Autowired
	    private RecaptchaService reCaptchaService;
	
	@PostMapping("/register")
	public ResponseEntity<?> registerAdmin(@RequestBody AdminProxy admin)
	{
		return ResponseEntity.status(HttpStatus.CREATED).body(service.RegisterAdmin(admin));
	}
	
	@GetMapping("/getAdminById/{id}")
	public ResponseEntity<?> getAdminById(@PathVariable("id") Integer id)
	{
		return ResponseEntity.status(HttpStatus.CREATED).body(service.getAdminById(id));
	}
	
	@GetMapping("/getAdminByEmail/{email}")
	public ResponseEntity<?> getAdminByEmail(@PathVariable("email") String email)
	{
		return ResponseEntity.status(HttpStatus.CREATED).body(service.getAdminByEmail(email));
	}
	
	@PostMapping("/loginReq")
	public LoginResponse login(@RequestBody LoginRequest loginRequest)
	{
//		System.out.println(environment.getProperty("local.server.port"));
//		if (reCaptchaService.verify(loginRequest.getCaptcha())) {
//			System.out.println(loginRequest.getPassword()+"\n"+loginRequest.getEmail()+"\n"+loginRequest.getCaptcha());	
//			return service.login(loginRequest);
//		}
		return service.login(loginRequest);
	}
	
	@PutMapping("/updateAdmin/{id}")
	public ResponseEntity<?> updateAdminById(@PathVariable("id") Integer id,@RequestBody AdminProxy admin)
	{
		return ResponseEntity.status(HttpStatus.CREATED).body(service.updateAdminById(id,admin));
	}
	
	@PostMapping("/resetpassword")
	public ResponseEntity<?> generateOtp(@RequestBody AdminEntity user)
	{
		return ResponseEntity.status(HttpStatus.OK).body(service.forgetPwd(user));
	}

	@GetMapping("/testOtp/{email}")
	public String testOtp(@PathVariable String email)
	{
		
		return service.testOtp(email);
	}
	
	 @PostMapping("/registerAdminwithImg")
	 public ResponseEntity<?> RegisterAdmin(
//	     @RequestPart("title") String title,
//	     @RequestPart("content") String content,
//	     @RequestPart("") String category
		@ModelAttribute("blog") AdminEntity adminEntity,
	     @RequestPart("images") List<MultipartFile> images
	 ) {
		 System.err.println("image upload controller....");
	     return ResponseEntity.status(HttpStatus.OK).body(service.createadmin(images, adminEntity));
	 }
	 

//	    @PostMapping("/submitForm")
//	    public ResponseEntity<String> submitForm(@RequestParam String name, @RequestParam String email, @RequestParam String recaptchaResponse) {
//	        if (reCaptchaService.verify(recaptchaResponse)) {
//	            // Process form data if reCAPTCHA is valid
//	            return ResponseEntity.ok("Form submitted successfully!");
//	        } else {
//	            // Handle invalid reCAPTCHA
//	            return ResponseEntity.badRequest().body("Invalid reCAPTCHA. Please try again.");
//	        }
//	    }
}
